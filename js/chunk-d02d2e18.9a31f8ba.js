(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d02d2e18"],{"0c69":function(t,e,a){"use strict";a("13fe")},"13fe":function(t,e,a){},1681:function(t,e,a){},"29a2":function(t,e,a){"use strict";a("c8a4")},6783:function(t,e,a){"use strict";var r=a("2fa3");e["a"]={getTweets:function(){return r["b"].get("/tweets")},createTweet:function(t){var e=t.tweetData;return r["b"].post("/tweets",e)},getTweet:function(t){var e=t.tweetId;return r["b"].get("/tweets/".concat(e))},getTweetReplies:function(t){var e=t.tweetId;return r["b"].get("/tweets/".concat(e,"/replies"))}}},"7d7e":function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",{staticClass:"ma-0 pa-0 d-flex flex-column main"},[a("v-card",{staticClass:"pa-3 align-center",staticStyle:{"border-bottom":"thin solid rgba(0, 0, 0, 0.12)"},attrs:{tile:"",flat:""}},[t._v("首頁")]),a("NewTweetCard",{attrs:{"current-user":t.currentUser},on:{"after-create-tweet":t.afterCreateTweet}}),a("v-system-bar",{staticStyle:{height:"50px"}}),a("div",{staticClass:"tweetslist"},t._l(t.tweets,(function(t){return a("TweetCard",{key:t.id,attrs:{"initial-tweet":t,user:t.User}})})),1)],1)},s=[],n=a("1da1"),i=a("5530"),o=(a("96cf"),function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",{staticClass:"pa-3",staticStyle:{"border-bottom":"thin solid rgba(0, 0, 0, 0.12)"},attrs:{tile:"",flat:""}},[a("v-row",{staticClass:"pa-0",staticStyle:{"flex-wrap":"nowrap"},attrs:{"no-gutters":""}},[a("v-col",{staticClass:"flex-grow-1"},[a("v-avatar",{staticClass:"mt-1"},[a("v-img",{attrs:{src:t._f("emptyImage")(t.currentUser.avatar),alt:t.currentUser.name}})],1)],1),a("v-col",{staticClass:"flex-shrink-1",attrs:{cols:"11"}},[a("v-container",{staticClass:"pa-0 ma-0",attrs:{fluid:""}},[a("v-form",{ref:"form",attrs:{"lazy-validation":""},on:{submit:function(e){return e.stopPropagation(),e.preventDefault(),t.handleSubmit.apply(null,arguments)}},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[a("v-textarea",{staticClass:"pa-0 ma-0",attrs:{flat:"",solo:"",rows:"2","no-resize":"","auto-grow":"",counter:"140",maxlength:"140",label:"有什麼新鮮事？",rules:[t.rules.required,t.rules.tweetRules,t.rules.spaceRules],value:t.value,required:""},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}}),a("v-card-actions",{staticClass:"pa-0 ma-0"},[a("v-spacer"),a("v-btn",{attrs:{loading:t.isLoading,disabled:!t.valid,type:"submit",rounded:"",color:"primary"}},[t._v(" 推文 ")])],1)],1)],1)],1)],1)],1)}),c=[],l=(a("498a"),a("6783")),u=a("2fa3"),d=a("2708"),f={name:"NewTweetCard",props:{currentUser:{type:Object,required:!0}},mixins:[d["a"]],data:function(){return{rules:{required:function(t){return!!t||"填寫您的推文"},tweetRules:function(t){return t&&t.length<=140||"推文字數限制(140)"},spaceRules:function(t){return/[^\s]/.test(t)||"填寫您的推文，輸入空格外的文字"}},value:"",isLoading:!1,valid:!0}},methods:{handleSubmit:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a,r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,t.$refs.form.validate(),t.value){e.next=7;break}return u["a"].fire({icon:"warning",title:"請寫下您的推文"}),e.abrupt("return");case 7:if(t.value.trim()){e.next=12;break}return u["a"].fire({icon:"warning",title:"填寫您的推文，輸入空格外的文字"}),e.abrupt("return");case 12:if(!(t.value.length>140)){e.next=15;break}return u["a"].fire({icon:"warning",title:"推文字數限制(140)"}),e.abrupt("return");case 15:return t.isLoading=!0,a={userId:t.currentUser.id,description:t.value},e.next=19,l["a"].createTweet({tweetData:a});case 19:if(r=e.sent,s=r.data,t.$refs.form.reset(),"error"!==s.status){e.next=24;break}throw new Error(s.message);case 24:t.$emit("after-create-tweet",{tweetData:a}),u["a"].fire({icon:"success",title:"推文成功"}),t.isLoading=!1,e.next=33;break;case 29:e.prev=29,e.t0=e["catch"](0),t.isLoading=!1,u["a"].fire({icon:"error",title:"無法新增推文，請稍後再試"});case 33:case"end":return e.stop()}}),e,null,[[0,29]])})))()}}},w=f,p=a("2877"),h=a("6544"),v=a.n(h),m=a("8212"),g=a("8336"),b=a("b0af"),y=a("99d9"),x=a("62ad"),C=a("a523"),k=a("4bd4"),O=a("adda"),j=a("0fd9"),T=a("2fa4"),_=a("a844"),I=Object(p["a"])(w,o,c,!1,null,null,null),S=I.exports;v()(I,{VAvatar:m["a"],VBtn:g["a"],VCard:b["a"],VCardActions:y["a"],VCol:x["a"],VContainer:C["a"],VForm:k["a"],VImg:O["a"],VRow:j["a"],VSpacer:T["a"],VTextarea:_["a"]});var L=a("8f7b"),R=a("2f62"),U={name:"Tweets",components:{NewTweetCard:S,TweetCard:L["a"]},data:function(){return{tweets:[]}},created:function(){this.fetchTweets()},computed:Object(i["a"])({},Object(R["d"])(["currentUser"])),methods:Object(i["a"])({fetchTweets:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,t.setShowOverlayLoading(null,{root:!0}),e.next=4,l["a"].getTweets();case 4:a=e.sent,t.tweets=a.data,e.next=12;break;case 8:e.prev=8,e.t0=e["catch"](0),e.t0,u["a"].fire({icon:"error",title:"無法取得推文，請稍後再試"});case 12:t.setShowOverlayLoading(null,{root:!0});case 13:case"end":return e.stop()}}),e,null,[[0,8]])})))()},afterCreateTweet:function(){this.fetchTweets()}},Object(R["c"])({setShowOverlayLoading:"setShowOverlayLoading"}))},V=U,H=(a("0c69"),a("a9e3"),a("c7cd"),a("8308"),a("3a66")),$=a("a9ad"),N=a("7560"),z=a("58df"),D=a("80d2"),E=Object(z["a"])(Object(H["a"])("bar",["height","window"]),$["a"],N["a"]).extend({name:"v-system-bar",props:{height:[Number,String],lightsOut:Boolean,window:Boolean},computed:{classes:function(){return Object(i["a"])({"v-system-bar--lights-out":this.lightsOut,"v-system-bar--absolute":this.absolute,"v-system-bar--fixed":!this.absolute&&(this.app||this.fixed),"v-system-bar--window":this.window},this.themeClasses)},computedHeight:function(){return this.height?isNaN(parseInt(this.height))?this.height:parseInt(this.height):this.window?32:24},styles:function(){return{height:Object(D["g"])(this.computedHeight)}}},methods:{updateApplication:function(){return this.$el?this.$el.clientHeight:this.computedHeight}},render:function(t){var e={staticClass:"v-system-bar",class:this.classes,style:this.styles,on:this.$listeners};return t("div",this.setBackgroundColor(this.color,e),Object(D["r"])(this))}}),B=Object(p["a"])(V,r,s,!1,null,"6d0751fe",null);e["default"]=B.exports;v()(B,{VCard:b["a"],VContainer:C["a"],VSystemBar:E})},8308:function(t,e,a){},"8f7b":function(t,e,a){"use strict";var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-card",{staticClass:"pa-3",staticStyle:{"border-bottom":"thin solid rgba(0, 0, 0, 0.12)"},attrs:{flat:"",tile:""}},[a("v-row",{staticClass:"pa-0",staticStyle:{"flex-wrap":"nowrap"},attrs:{"no-gutters":""}},[a("v-col",{staticClass:"flex-grow-1"},[a("router-link",{attrs:{to:{name:"user",params:{id:t.tweet.User.id}}}},[a("v-avatar",{staticClass:"mt-1"},[a("v-img",{attrs:{src:t._f("emptyImage")(t.tweet.User.avatar),alt:t.tweet.User.name}})],1)],1)],1),a("v-col",{staticClass:"flex-shrink-1",attrs:{cols:"11"}},[a("router-link",{staticStyle:{"text-decoration":"none"},attrs:{to:{name:"tweet",params:{id:t.tweet.id}}}},[a("v-row",{staticClass:"pa-2",attrs:{"no-gutters":"",align:"center"}},[a("p",{staticClass:"subtitle-2 font-weight-bold mr-1 my-0 pa-0"},[t._v(" "+t._s(t.tweet.User.name)+" ")]),a("p",{staticClass:"subtitle-2 grey--text font-weight-regular my-0 pa-0"},[t._v(" @"+t._s(t.tweet.User.account)+" ")]),a("p",{staticClass:"subtitle-2 font-weight-regular grey--text pa-0 my-0 ml-1"},[t._v(" ‧ "+t._s(t._f("fromNow")(t.tweet.createdAt))+" ")])]),a("v-row",{staticClass:"font-weight-normal px-2",attrs:{"no-gutters":"",align:"center"}},[a("v-col",{staticClass:"ma-0 pa-0",attrs:{cols:"12"}},[a("p",{staticClass:"body-2 black--text font-weight-normal text-justify my-0"},[t._v(" "+t._s(t.tweet.description)+" ")])])],1)],1),a("v-row",{staticClass:"font-weight-normal pa-2",attrs:{"no-gutters":"",align:"center"}},[a("v-col",{staticClass:"d-flex justify-space-between mr-5",attrs:{cols:"1"}},[a("div",{staticClass:"d-flex align-center cursor-pointer",on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.replyTweet.apply(null,arguments)}}},[a("v-icon",{staticStyle:{"font-size":"18px"},attrs:{color:"grey"}},[t._v("far fa-comment")]),a("p",{staticClass:"subtitle-2 font-weight-normal grey--text pa-0 my-0 ml-2"},[t._v(" "+t._s(t.tweet.replyCounts)+" ")])],1)]),a("v-col",{staticClass:"d-flex justify-space-between ml-5",attrs:{cols:"1"}},[a("div",{staticClass:"d-flex align-center",class:t.cursorStyle},[t.tweet.isLiked?a("v-icon",{staticStyle:{"font-size":"18px"},attrs:{disabled:t.currentUser.id===t.tweet.User.id,color:"red"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.deleteLike(t.tweet.id)}}},[t._v("fas fa-heart")]):a("v-icon",{staticStyle:{"font-size":"18px"},attrs:{disabled:t.currentUser.id===t.tweet.User.id,color:"grey"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.addLike(t.tweet.id)}}},[t._v("far fa-heart")]),a("p",{staticClass:"subtitle-2 grey--text pa-0 my-0 ml-2"},[t._v(" "+t._s(t.tweet.likeCounts)+" ")])],1)])],1)],1)],1)],1)},s=[],n=a("1da1"),i=a("5530"),o=(a("96cf"),a("2708")),c=a("2f62"),l=a("4cce"),u=a("2fa3"),d={name:"TweetCard",props:{initialTweet:{type:Object,required:!0}},mixins:[o["b"],o["a"]],data:function(){return{tweet:Object(i["a"])({},this.initialTweet)}},computed:Object(i["a"])({cursorStyle:function(){return this.currentUser.id===this.tweet.User.id?"cursor-normal":"cursor-pointer"}},Object(c["d"])(["currentUser"])),methods:Object(i["a"])(Object(i["a"])({replyTweet:function(){this.setTweet(this.tweet),this.setTweetReplyDialogOpen(!0)}},Object(c["c"])({setTweet:"tweets/setTweet",setTweetReplyDialogOpen:"tweets/setTweetReplyDialogOpen"})),{},{addLike:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(a.prev=0,e.tweet.User.id!==e.currentUser.id){a.next=5;break}return u["a"].fire({icon:"error",title:"無法將自己的推文加入LIKE"}),e.isLoading=!1,a.abrupt("return");case 5:return a.next=7,l["a"].addLike({tweetId:t});case 7:if(r=a.sent,s=r.data,"success"===s.status){a.next=11;break}throw new Error(s.message);case 11:e.tweet=Object(i["a"])(Object(i["a"])({},e.tweet),{},{isLiked:!0,likeCounts:e.tweet.likeCounts+1}),a.next=18;break;case 14:a.prev=14,a.t0=a["catch"](0),console.log("error",a.t0),u["a"].fire({icon:"error",title:"無法將推文加入LIKE，請稍後再試"});case 18:case"end":return a.stop()}}),a,null,[[0,14]])})))()},deleteLike:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var r,s;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,l["a"].deleteLike({tweetId:t});case 3:if(r=a.sent,s=r.data,"success"===s.status){a.next=7;break}throw new Error(s.message);case 7:e.tweet=Object(i["a"])(Object(i["a"])({},e.tweet),{},{isLiked:!1,likeCounts:e.tweet.likeCounts-1}),e.$emit("after-delete-like",t),a.next=15;break;case 11:a.prev=11,a.t0=a["catch"](0),console.log("error",a.t0),u["a"].fire({icon:"error",title:"無法將推文移除LIKE，請稍後再試"});case 15:case"end":return a.stop()}}),a,null,[[0,11]])})))()}})},f=d,w=(a("29a2"),a("2877")),p=a("6544"),h=a.n(p),v=a("8212"),m=a("b0af"),g=a("62ad"),b=a("132d"),y=a("adda"),x=a("0fd9"),C=Object(w["a"])(f,r,s,!1,null,null,null);e["a"]=C.exports;h()(C,{VAvatar:v["a"],VCard:m["a"],VCol:g["a"],VIcon:b["a"],VImg:y["a"],VRow:x["a"]})},a844:function(t,e,a){"use strict";var r=a("5530"),s=(a("a9e3"),a("1681"),a("8654")),n=a("58df"),i=Object(n["a"])(s["a"]);e["a"]=i.extend({name:"v-textarea",props:{autoGrow:Boolean,noResize:Boolean,rowHeight:{type:[Number,String],default:24,validator:function(t){return!isNaN(parseFloat(t))}},rows:{type:[Number,String],default:5,validator:function(t){return!isNaN(parseInt(t,10))}}},computed:{classes:function(){return Object(r["a"])({"v-textarea":!0,"v-textarea--auto-grow":this.autoGrow,"v-textarea--no-resize":this.noResizeHandle},s["a"].options.computed.classes.call(this))},noResizeHandle:function(){return this.noResize||this.autoGrow}},watch:{lazyValue:function(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)},rowHeight:function(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)}},mounted:function(){var t=this;setTimeout((function(){t.autoGrow&&t.calculateInputHeight()}),0)},methods:{calculateInputHeight:function(){var t=this.$refs.input;if(t){t.style.height="0";var e=t.scrollHeight,a=parseInt(this.rows,10)*parseFloat(this.rowHeight);t.style.height=Math.max(a,e)+"px"}},genInput:function(){var t=s["a"].options.methods.genInput.call(this);return t.tag="textarea",delete t.data.attrs.type,t.data.attrs.rows=this.rows,t},onInput:function(t){s["a"].options.methods.onInput.call(this,t),this.autoGrow&&this.calculateInputHeight()},onKeyDown:function(t){this.isFocused&&13===t.keyCode&&t.stopPropagation(),this.$emit("keydown",t)}}})},c8a4:function(t,e,a){}}]);
//# sourceMappingURL=chunk-d02d2e18.9a31f8ba.js.map