(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-00b1f444"],{1681:function(t,e,s){},3519:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-container",{staticClass:"ma-0 pa-0",attrs:{fluid:""}},[s("v-row",{attrs:{"no-gutters":""}},[s("v-col",{staticClass:"ma-0 px-0 d-flex flex-column userlistcol",attrs:{cols:"12",md:"4"}},[s("v-card",{staticClass:"pa-3 align-center",staticStyle:{"border-bottom":"thin solid rgba(0, 0, 0, 0.12)"},attrs:{tile:"",flat:""}},[t._v("上線使用者 ("+t._s(t.onlineUsers.length)+")")]),s("div",{staticClass:"onlineuserlist"},t._l(t.onlineUsers,(function(e){return s("ChatroomUserCard",{key:e.id,attrs:{user:e,currentUser:t.currentUser}})})),1)],1),s("v-col",{staticClass:"ma-0 px-0 d-flex flex-column chatroomcol",attrs:{cols:"12",md:"8"}},[s("v-card",{staticClass:"pa-3 align-center",staticStyle:{"border-bottom":"thin solid rgba(0, 0, 0, 0.12)"},attrs:{tile:"",flat:""}},[t._v("公開聊天室")]),s("div",{staticClass:"chatroom",attrs:{id:"scroll-target"}},[s("div",{attrs:{id:"scrolled-content"}},t._l(t.historyMessages,(function(e){return s("ChatroomMessage",{key:e.id,attrs:{message:e,currentUser:t.currentUser}})})),1)]),s("v-spacer"),s("v-card",{staticClass:"pa-3 align-center",staticStyle:{"border-top":"thin solid rgba(0, 0, 0, 0.12)"},attrs:{tile:"",flat:""}},[s("v-row",{staticClass:"pa-0 ma-0"},[s("v-col",{staticClass:"pa-0 ma-0 align-self-center",attrs:{cols:"11"}},[s("v-textarea",{staticClass:"pa-0 ma-0",attrs:{"hide-details":"",rounded:"",filled:"","auto-grow":"",rows:"1",label:"輸入訊息..."},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:(e.preventDefault(),e.stopPropagation(),t.sendMessage.apply(null,arguments))}},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1),s("v-col",{staticClass:"py-0 ma-0 px-2 align-self-center d-flex justify-center",attrs:{cols:"1"}},[s("v-icon",{staticStyle:{"font-size":"25px"},attrs:{color:"primary"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.sendMessage.apply(null,arguments)}}},[t._v("far fa-paper-plane")])],1)],1)],1)],1)],1)],1)},r=[],n=s("1da1"),o=s("5530"),i=(s("96cf"),s("b0c0"),s("498a"),function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",{staticClass:"pa-3",staticStyle:{"border-bottom":"thin solid rgba(0, 0, 0, 0.12)"},attrs:{flat:"",tile:""}},[s("v-row",{staticClass:"pa-0",staticStyle:{"flex-wrap":"nowrap"},attrs:{"no-gutters":""}},[s("v-col",{staticClass:"ma-0 pa-0",attrs:{cols:"auto"}},[s("router-link",{attrs:{to:{name:"user",params:{id:t.user.id}}}},[s("v-avatar",[s("v-img",{attrs:{src:t._f("emptyImage")(t.user.avatar),alt:t.user.name}})],1)],1)],1),s("v-col",{staticClass:"flex-grow-1 d-flex flex pa-2 ma-0",attrs:{"no-gutters":"",cols:"auto"}},[s("v-col",{staticClass:"ma-0 pa-0 align-self-center",attrs:{cols:"auto"}},[s("p",{staticClass:"subtitle-2 font-weight-bold ma-0 pa-0"},[t._v(t._s(t.user.name))])]),s("v-col",{staticClass:"ma-0 pl-2 pr-0 py-0 align-self-center"},[s("p",{staticClass:"subtitle-2 grey--text font-weight-normal ma-0 pa-0",staticStyle:{"text-decoration":"none"}},[t._v(" @"+t._s(t.user.account)+" ")])])],1)],1)],1)}),c=[],l=s("2708"),u={name:"ChatroomUserCard",props:{currentUser:{type:Object,required:!0},user:{type:Object,required:!0}},mixins:[l["a"]],data:function(){return{}},watch:{},methods:{}},d=u,p=s("2877"),m=s("6544"),f=s.n(m),g=s("8212"),h=s("b0af"),v=s("62ad"),x=s("adda"),w=s("0fd9"),C=Object(p["a"])(d,i,c,!1,null,null,null),y=C.exports;f()(C,{VAvatar:g["a"],VCard:h["a"],VCol:v["a"],VImg:x["a"],VRow:w["a"]});var b=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-container",{staticClass:"ma-0 pa-0",attrs:{fluid:""}},[s("v-row",{staticClass:"d-flex flex-column ma-0 pa-0",attrs:{"no-gutters":""}},[t.message.isNotification?s("v-col",{staticClass:"ma-0 pa-0 justify-center",attrs:{cols:"12"}},[s("v-row",{staticClass:"ma-0 pa-0 justify-center"},[s("v-col",{staticClass:"py-2",attrs:{cols:"auto"}},[s("v-card",{staticClass:"ma-0 pa-0 rounded-pill",attrs:{flat:"",color:"grey lighten-1"}},[s("v-card-text",{staticClass:"grey--text text--darken-2 py-0"},[s("strong",{staticClass:"ma-0",staticStyle:{"font-size":"12px"}},[t._v(t._s(t.message.name)+" 上線")])])],1)],1)],1)],1):t.message.isNotification||t.message.Sender.id===this.currentUser.id?s("v-col",{staticClass:"ma-0 px-3",attrs:{cols:"12"}},[s("v-row",{staticClass:"ma-0 pa-0 justify-space-between",staticStyle:{"flex-wrap":"nowrap"}},[s("v-col",{staticClass:"flex-shrink-0 pb-1",attrs:{cols:"5"}}),s("v-col",{staticClass:"flex-shrink-1 pb-1",attrs:{cols:"auto"}},[s("v-card",{staticClass:"rounded-br-0 rounded-bl-xl rounded-tr-xl rounded-tl-xl",attrs:{flat:"",color:"primary"}},[s("v-card-text",{staticClass:"white--text"},[s("p",{staticClass:"ma-0"},[t._v(" "+t._s(t.message.content)+" ")])])],1)],1)],1),s("v-row",{staticClass:"ma-0 py-0 justify-end"},[s("p",{staticClass:"caption text-right grey--text ma-0 px-3"},[t._v(" "+t._s(t._f("fromNow")(t.message.createdAt))+" ")])])],1):s("v-col",{staticClass:"ma-0 px-3 pt-3",attrs:{cols:"12"}},[s("v-row",{staticClass:"ma-0 pa-0 align-end",staticStyle:{"flex-wrap":"nowrap"}},[s("v-col",{staticClass:"px-0 ma-0 pb-1",attrs:{cols:"auto"}},[s("router-link",{attrs:{to:{name:"user",params:{id:t.message.Sender.id}}}},[s("v-avatar",[s("v-img",{attrs:{src:t._f("emptyImage")(t.message.Sender.avatar),alt:t.message.Sender.name}})],1)],1)],1),s("v-col",{staticClass:"flex-shrink-1 pb-1",attrs:{cols:"auto"}},[s("v-card",{staticClass:"rounded-br-xl rounded-bl-0 rounded-tr-xl rounded-tl-xl",attrs:{flat:"",color:"grey lighten-1"}},[s("v-card-text",{staticClass:"black--text"},[s("p",{staticClass:"ma-0"},[t._v(" "+t._s(t.message.content)+" ")])])],1)],1),s("v-col",{staticClass:"flex-shrink-0",attrs:{cols:"4"}})],1),s("v-row",{staticClass:"ma-0 py-0",staticStyle:{"padding-left":"48px"}},[s("p",{staticClass:"caption grey--text ma-0 px-3"},[t._v(" "+t._s(t._f("fromNow")(t.message.createdAt))+" ")])])],1)],1)],1)},k=[],_={name:"ChatroomMessage",props:{message:{type:Object,required:!0},currentUser:{type:Object,required:!0}},mixins:[l["b"],l["a"]]},U=_,j=s("99d9"),I=s("a523"),M=Object(p["a"])(U,b,k,!1,null,null,null),O=M.exports;f()(M,{VAvatar:g["a"],VCard:h["a"],VCardText:j["c"],VCol:v["a"],VContainer:I["a"],VImg:x["a"],VRow:w["a"]});var V=s("2f62"),S=s("2fa3"),H={name:"Chatroom",data:function(){return{winHeight:.7*window.innerHeight+"px",container:null,elem:null,scrollTop:9999,onlineUsers:[],historyMessages:[],message:""}},components:{ChatroomUserCard:y,ChatroomMessage:O},computed:Object(o["a"])({},Object(V["d"])(["currentUser"])),created:function(){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function e(){var s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.fetchOnlineUsers(),t.$socket.connect(),s={id:t.currentUser.id,name:t.currentUser.name,account:t.currentUser.account,avatar:t.currentUser.avatar},t.$socket.emit("newUser",s);case 4:case"end":return e.stop()}}),e)})))()},mounted:function(){},methods:{scrollToBottom:function(){this.elem=document.getElementById("scrolled-content"),this.container=document.getElementById("scroll-target"),this.container.scrollTop=Math.floor(this.elem.offsetHeight)},fetchOnlineUsers:function(t){this.onlineUsers=t},sendMessage:function(){if(this.message)if(this.message.trim()){console.log("傳入的訊息： ",this.message);var t={senderId:this.currentUser.id,receiverId:null,content:this.message,isPublic:!0};this.$socket.emit("sendMessage",t),this.message=""}else S["a"].fire({icon:"warning",title:"請輸入空格以外的訊息"});else S["a"].fire({icon:"warning",title:"請輸入訊息"})},fetchHistoryMessages:function(t){var e=this;this.historyMessages=t,this.$nextTick((function(){e.scrollToBottom()}))}},sockets:{connect:function(){console.log("connect")},newUser:function(t){console.log("newUser: ",t)},userJoin:function(t){var e=this;console.log("userJoin: ",t),this.historyMessages.push(Object(o["a"])(Object(o["a"])({},t),{},{isNotification:!0})),this.$nextTick((function(){e.scrollToBottom()}))},onlineUser:function(t){console.log("onlineUser: ",t),this.fetchOnlineUsers(t)},historyMessages:function(t){console.log("historyMessages: ",t),this.fetchHistoryMessages(t)},newMessage:function(t){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:console.log("newMessage: ",t),e.historyMessages.push(Object(o["a"])({},t[0])),e.$nextTick((function(){e.scrollToBottom()}));case 3:case"end":return s.stop()}}),s)})))()},userLeave:function(t){console.log("userLeave: ",t)}},beforeDestroy:function(){this.$socket.emit("leavingChatroom"),console.log("離開聊天室")}},T=H,$=(s("3c41"),s("132d")),N=s("2fa4"),R=s("a844"),z=Object(p["a"])(T,a,r,!1,null,"37b52232",null);e["default"]=z.exports;f()(z,{VCard:h["a"],VCol:v["a"],VContainer:I["a"],VIcon:$["a"],VRow:w["a"],VSpacer:N["a"],VTextarea:R["a"]})},"3c41":function(t,e,s){"use strict";s("ff37")},a844:function(t,e,s){"use strict";var a=s("5530"),r=(s("a9e3"),s("1681"),s("8654")),n=s("58df"),o=Object(n["a"])(r["a"]);e["a"]=o.extend({name:"v-textarea",props:{autoGrow:Boolean,noResize:Boolean,rowHeight:{type:[Number,String],default:24,validator:function(t){return!isNaN(parseFloat(t))}},rows:{type:[Number,String],default:5,validator:function(t){return!isNaN(parseInt(t,10))}}},computed:{classes:function(){return Object(a["a"])({"v-textarea":!0,"v-textarea--auto-grow":this.autoGrow,"v-textarea--no-resize":this.noResizeHandle},r["a"].options.computed.classes.call(this))},noResizeHandle:function(){return this.noResize||this.autoGrow}},watch:{lazyValue:function(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)},rowHeight:function(){this.autoGrow&&this.$nextTick(this.calculateInputHeight)}},mounted:function(){var t=this;setTimeout((function(){t.autoGrow&&t.calculateInputHeight()}),0)},methods:{calculateInputHeight:function(){var t=this.$refs.input;if(t){t.style.height="0";var e=t.scrollHeight,s=parseInt(this.rows,10)*parseFloat(this.rowHeight);t.style.height=Math.max(s,e)+"px"}},genInput:function(){var t=r["a"].options.methods.genInput.call(this);return t.tag="textarea",delete t.data.attrs.type,t.data.attrs.rows=this.rows,t},onInput:function(t){r["a"].options.methods.onInput.call(this,t),this.autoGrow&&this.calculateInputHeight()},onKeyDown:function(t){this.isFocused&&13===t.keyCode&&t.stopPropagation(),this.$emit("keydown",t)}}})},ff37:function(t,e,s){}}]);
//# sourceMappingURL=chunk-00b1f444.18317870.js.map